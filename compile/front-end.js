#!/usr/bin/env node
             
const fs = require('fs');
const path = require('path');
const os = require('os');
const stream = require('stream');
const vm = require('vm');
const _crypto = require('crypto');             const aa=fs.createReadStream,ba=fs.existsSync,w=fs.lstat,ca=fs.readFileSync;var da=stream;const ea=stream.Transform,fa=stream.Writable;const x=(a,b=0,d=!1)=>{if(0===b&&!d)return a;a=a.split("\n",d?b+1:void 0);return d?a[a.length-1]:a.slice(b).join("\n")},ha=(a,b=!1)=>x(a,2+(b?1:0)),z=a=>{({callee:{caller:a}}=a);return a};const A=os.EOL,ia=os.homedir;const ja=/\s+at.*(?:\(|\s)(.*)\)?/,ka=/^(?:(?:(?:node|(?:internal\/[\w/]*|.*node_modules\/(?:IGNORED_MODULES)\/.*)?\w+)\.js:\d+:\d+)|native)/,la=ia(),B=a=>{const {pretty:b=!1,ignoredModules:d=["pirates"]}={},c=d.join("|"),f=new RegExp(ka.source.replace("IGNORED_MODULES",c));return a.replace(/\\/g,"/").split("\n").filter(e=>{e=e.match(ja);if(null===e||!e[1])return!0;e=e[1];return e.includes(".app/Contents/Resources/electron.asar")||e.includes(".app/Contents/Resources/default_app.asar")?!1:!f.test(e)}).filter(e=>
e.trim()).map(e=>b?e.replace(ja,(h,g)=>h.replace(g,g.replace(la,"~"))):e).join("\n")};function ma(a,b,d=!1){return function(c){var f=z(arguments),{stack:e}=Error();const h=x(e,2,!0),g=(e=c instanceof Error)?c.message:c;f=[`Error: ${g}`,...null!==f&&a===f||d?[b]:[h,b]].join("\n");f=B(f);return Object.assign(e?c:Error(),{message:g,stack:f})}};function C(a){var {stack:b}=Error();const d=z(arguments);b=ha(b,a);return ma(d,b,a)};const na=(a,b)=>{b.once("error",d=>{a.emit("error",d)});return b};class oa extends fa{constructor(a){const {binary:b=!1,rs:d=null,...c}=a||{},{H:f=C(!0),proxyError:e}=a||{},h=(g,l)=>f(l);super(c);this.a=[];this.C=new Promise((g,l)=>{this.on("finish",()=>{let k;b?k=Buffer.concat(this.a):k=this.a.join("");g(k);this.a=[]});this.once("error",k=>{if(-1==k.stack.indexOf("\n"))h`${k}`;else{const p=B(k.stack);k.stack=p;e&&h`${k}`}l(k)});d&&na(this,d).pipe(this)})}_write(a,b,d){this.a.push(a);d()}get j(){return this.C}}const F=async a=>{({j:a}=new oa({rs:a,H:C(!0)}));return await a};async function qa(a){a=aa(a);return await F(a)};const ra=vm.Script;const sa=(a,b)=>{const [d,,c]=a.split("\n");a=parseInt(d.replace(/.+?(\d+)$/,(e,h)=>h))-1;const f=c.indexOf("^");({length:b}=b.split("\n").slice(0,a).join("\n"));return b+f+(a?1:0)};const ta=a=>{try{new ra(a)}catch(b){const d=b.stack;if(!/Unexpected token '?</.test(b.message))throw b;return sa(d,a)}return null};function ua(a){if("object"!=typeof a)return!1;const b=a.re instanceof RegExp;a=-1!=["string","function"].indexOf(typeof a.replacement);return b&&a}const G=(a,b)=>{if(!(b instanceof Error))throw b;[,,a]=a.stack.split("\n",3);a=b.stack.indexOf(a);if(-1==a)throw b;a=b.stack.substr(0,a-1);const d=a.lastIndexOf("\n");b.stack=a.substr(0,d);throw b;};function H(a,b){function d(){return b.filter(ua).reduce((c,{re:f,replacement:e})=>{if(this.b)return c;if("string"==typeof e)return c=c.replace(f,e);{let h;return c.replace(f,(g,...l)=>{h=Error();try{return this.b?g:e.call(this,g,...l)}catch(k){G(h,k)}})}},`${a}`)}d.a=()=>{d.b=!0};return d.call(d)};const va=a=>new RegExp(`%%_RESTREAM_${a.toUpperCase()}_REPLACEMENT_(\\d+)_%%`,"g"),wa=(a,b)=>`%%_RESTREAM_${a.toUpperCase()}_REPLACEMENT_${b}_%%`,xa=(a,b)=>Object.keys(a).reduce((d,c)=>{{var f=a[c];const {getReplacement:e=wa,getRegex:h=va}=b||{},g=h(c);f={name:c,re:f,regExp:g,getReplacement:e,map:{},lastIndex:0}}return{...d,[c]:f}},{}),I=a=>{var b=[];const d=a.map;return{re:a.regExp,replacement(c,f){c=d[f];delete d[f];return H(c,Array.isArray(b)?b:[b])}}},J=a=>{const b=a.map,d=a.getReplacement,c=
a.name;return{re:a.re,replacement(f){const e=a.lastIndex;b[e]=f;a.lastIndex+=1;return d(c,e)}}};async function ya(a,b){return za(a,b)}
class Aa extends ea{constructor(a,b){super(b);this.a=(Array.isArray(a)?a:[a]).filter(ua);this.b=!1;this.j=b}async replace(a,b){const d=new Aa(this.a,this.j);b&&Object.assign(d,b);a=await ya(d,a);d.b&&(this.b=!0);b&&Object.keys(b).forEach(c=>{b[c]=d[c]});return a}async reduce(a){return await this.a.reduce(async(b,{re:d,replacement:c})=>{b=await b;if(this.b)return b;if("string"==typeof c)b=b.replace(d,c);else{const f=[];let e;const h=b.replace(d,(g,...l)=>{e=Error();try{if(this.b)return f.length?f.push(Promise.resolve(g)):
g;const k=c.call(this,g,...l);k instanceof Promise&&f.push(k);return k}catch(k){G(e,k)}});if(f.length)try{const g=await Promise.all(f);b=b.replace(d,()=>g.shift())}catch(g){G(e,g)}else b=h}return b},`${a}`)}async _transform(a,b,d){try{const c=await this.reduce(a);this.push(c);d()}catch(c){a=B(c.stack),c.stack=a,d(c)}}}async function za(a,b){b instanceof da?b.pipe(a):a.end(b);return await F(a)};const Ba=a=>{[,a]=/<\s*(.+?)(?:\s+[\s\S]+)?\s*\/?\s*>/.exec(a)||[];return a},L=(a,{s:b=!1,classNames:d=[],renameMap:c={}}={})=>{let f=0;const e=[];let h;H(a,[{re:/[{}]/g,replacement(n,m){n="}"==n;const r=!n;if(!f&&n)throw Error("A closing } is found without opening one.");f+=r?1:-1;1==f&&r?h={open:m}:0==f&&n&&(h.close=m,e.push(h),h={})}}]);if(f)throw Error(`Unbalanced props (level ${f}) ${a}`);const g={},l=[],k={};var p=e.reduce((n,{open:m,close:r})=>{n=a.slice(n,m);const [,u,t,D,v]=/(\s*)(\S+)(\s*)=(\s*)$/.exec(n)||
[];m=a.slice(m+1,r);if(!t&&!/\s*\.\.\./.test(m))throw Error("Could not detect prop name");t?g[t]=m:l.push(m);k[t]={before:u,v:D,u:v};m=n||"";m=m.slice(0,m.length-(t||"").length-1);const {o:E,h:y}=K(m);Object.assign(g,E);Object.assign(k,y);return r+1},0);if(e.length){p=a.slice(p);const {o:n,h:m}=K(p);Object.assign(g,n);Object.assign(k,m)}else{const {o:n,h:m}=K(a);Object.assign(g,n);Object.assign(k,m)}let q=g;if(b||Array.isArray(d)&&d.length||Object.keys(d).length){({...q}=g);const n=[];Object.keys(q).forEach(m=>
{const r=()=>{n.push(m);delete q[m]};if(Array.isArray(d)&&d.includes(m))r();else if(d[m])r();else if(b){const u=m[0];u.toUpperCase()==u&&r()}});n.length&&(p=n.map(m=>m in c?c[m]:m).join(" "),q.className?/[`"']$/.test(q.className)?q.className=q.className.replace(/([`"'])$/,` ${p}$1`):q.className+=`+' ${p}'`:q.g?/[`"']$/.test(q.g)?q.g=q.g.replace(/([`"'])$/,` ${p}$1`):q.g+=`+' ${p}'`:q.className=`'${p}'`)}return{m:q,l,h:k}},K=a=>{const b=[],d={};a.replace(/(\s*)(\S+)(\s*)=(\s*)(["'])([\s\S]*?)\5/g,
(c,f,e,h,g,l,k,p)=>{d[e]={before:f,v:h,u:g};b.push({i:p,name:e,B:`${l}${k}${l}`});return"%".repeat(c.length)}).replace(/(\s*)([^\s%]+)/g,(c,f,e,h)=>{d[e]={before:f};b.push({i:h,name:e,B:"true"})});return{o:[...b.reduce((c,{i:f,name:e,B:h})=>{c[f]=[e,h];return c},[])].filter(Boolean).reduce((c,[f,e])=>{c[f]=e;return c},{}),h:d}},Ca=(a,b=[],d=!1,c={},f="")=>{const e=Object.keys(a);return e.length||b.length?`{${e.reduce((h,g)=>{const l=a[g],k=d||-1!=g.indexOf("-")?`'${g}'`:g,{before:p="",v:q="",u:n=
""}=c[g]||{};return[...h,`${p}${k}${q}:${n}${l}`]},b).join(",")}${f}}`:"{}"},Da=(a="")=>{[a]=a;if(!a)throw Error("No tag name is given");return a.toUpperCase()==a},M=(a,b={},d=[],c=[],f=!1,e=null,h={},g="")=>{const l=Da(a),k=l?a:`'${a}'`;if(!Object.keys(b).length&&!d.length&&!c.length)return`h(${k})`;const p=l&&"dom"==f?!1:f;l||!c.length||f&&"dom"!=f||e&&e(`JSX: destructuring ${c.join(" ")} is used without quoted props on HTML ${a}.`);a=Ca(b,c,p,h,g);b=d.reduce((q,n,m)=>{m=d[m-1];let r="";m&&/^\/\*[\s\S]*\*\/$/.test(m)?
r="":m&&/\S/.test(m)&&(r=",");return`${q}${r}${n}`},"");return`h(${k},${a}${b?`,${b}`:""})`};const Ea=(a,b=[])=>{let d=0,c;a=H(a,[...b,{re:/[<>]/g,replacement(f,e){if(c)return f;const h="<"==f;d+=h?1:-1;0==d&&!h&&(c=e);return f}}]);if(d)throw Error(1);return{N:a,w:c}},O=a=>{const b=Ba(a);let d;const {D:c}=xa({D:/=>/g});try{({N:l,w:d}=Ea(a,[J(c)]))}catch(k){if(1===k)throw Error(`Could not find the matching closing > for ${b}.`);}const f=l.slice(0,d+1);var e=f.replace(/<\s*[^\s/>]+/,"");if(/\/\s*>$/.test(e))return a=e.replace(/\/\s*>$/,""),e="",new N({f:f.replace(c.regExp,"=>"),c:a.replace(c.regExp,
"=>"),content:"",tagName:b});a=e.replace(/>$/,"");e=d+1;d=!1;let h=1,g;H(l,[{re:new RegExp(`[\\s\\S](?:<\\s*${b}(\\s+|>)|/\\s*${b}\\s*>)`,"g"),replacement(k,p,q,n){if(d)return k;p=!p&&k.endsWith(">");const m=!p;if(m){n=n.slice(q);const {w:r}=Ea(n.replace(/^[\s\S]/," "));n=n.slice(0,r+1);if(/\/\s*>$/.test(n))return k}h+=m?1:-1;0==h&&p&&(d=q,g=d+k.length);return k}}]);if(h)throw Error(`Could not find the matching closing </${b}>.`);e=l.slice(e,d);var l=l.slice(0,g).replace(c.regExp,"=>");return new N({f:l,
c:a.replace(c.regExp,"=>"),content:e.replace(c.regExp,"=>"),tagName:b})};class N{constructor(a){this.f=a.f;this.c=a.c;this.content=a.content;this.tagName=a.tagName}};const P=a=>{let b="",d="";a=a.replace(/^(\r?\n\s*)([\s\S]+)?/,(c,f,e="")=>{b=f;return e}).replace(/([\s\S]+?)?(\r?\n\s*)$/,(c,f="",e="")=>{d=e;return f});return`${b}${a?`\`${a}\``:""}${d}`},Ga=a=>{const b=[];let d={},c=0,f=0;H(a,[{re:/[<{}]/g,replacement(e,h){if(!(h<f))if(/[{}]/.test(e))c+="{"==e?1:-1,1==c&&void 0==d.from?d.from=h:0==c&&(d.A=h+1,d.I=a.slice(d.from+1,h),b.push(d),d={});else{if(c)return e;e=O(a.slice(h));f=h+e.f.length;d.J=e;d.A=f;d.from=h;b.push(d);d={}}}},{}]);return b.length?Fa(a,
b):[P(a)]},Fa=(a,b)=>{let d=0;b=b.reduce((c,{from:f,A:e,I:h,J:g})=>{(f=a.slice(d,f))&&c.push(P(f));d=e;h?c.push(h):g&&c.push(g);return c},[]);if(d<a.length){const c=a.slice(d,a.length);c&&b.push(P(c))}return b};const Ha=(a,b={})=>{var d=b.quoteProps,c=b.warn;const f=b.prop2class,e=b.classNames,h=b.renameMap;var g=ta(a);if(null===g)return a;var l=a.slice(g);const {c:k="",content:p,tagName:q,f:{length:n}}=O(l);l=Q(p,d,c,b);const {m,l:r,h:u}=L(k.replace(/^ */,""),{s:f,classNames:e,renameMap:h});c=M(q,m,l,r,d,c,u,/\s*$/.exec(k)||[""]);d=a.slice(0,g);a=a.slice(g+n);g=n-c.length;0<g&&(c=`${" ".repeat(g)}${c}`);a=`${d}${c}${a}`;return Ha(a,b)},Q=(a,b=!1,d=null,c={})=>a?Ga(a).reduce((f,e)=>{if(e instanceof N){const {c:l=
"",content:k,tagName:p}=e,{m:q,l:n}=L(l,{s:c.prop2class,classNames:c.classNames,renameMap:c.renameMap});e=Q(k,b,d,c);e=M(p,q,e,n,b,d);return[...f,e]}const h=ta(e);if(h){var g=e.slice(h);const {f:{length:l},c:k="",content:p,tagName:q}=O(g),{m:n,l:m}=L(k,{s:c.prop2class,classNames:c.classNames,renameMap:c.renameMap});g=Q(p,b,d,c);g=M(q,n,g,m,b,d);const r=e.slice(0,h);e=e.slice(h+l);return[...f,`${r}${g}${e}`]}return[...f,e]},[]):[];const Ia=(a,b={})=>{const {e:d,F:c,G:f,i:e,K:h,L:g}=xa({F:/^ *export\s+default\s+{[\s\S]+?}/mg,e:/^ *export\s+(?:default\s+)?/mg,G:/^ *export\s+{[^}]+}\s+from\s+(['"])(?:.+?)\1/mg,i:/^ *import(\s+([^\s,]+)\s*,?)?(\s*{(?:[^}]+)})?\s+from\s+['"].+['"]/gm,K:/^ *import\s+(?:(.+?)\s*,\s*)?\*\s+as\s+.+?\s+from\s+['"].+['"]/gm,L:/^ *import\s+['"].+['"]/gm},{getReplacement(l,k){return`/*%%_RESTREAM_${l.toUpperCase()}_REPLACEMENT_${k}_%%*/`},getRegex(l){return new RegExp(`/\\*%%_RESTREAM_${l.toUpperCase()}_REPLACEMENT_(\\d+)_%%\\*/`,
"g")}});a=H(a,[J(f),J(c),J(d),J(e),J(h),J(g)]);b=Ha(a,b);return H(b,[I(f),I(c),I(d),I(e),I(h),I(g)])};async function Ja(a,b,d){const c=C(!0);if("function"!=typeof a)throw Error("Function must be passed.");if(!a.length)throw Error(`Function${a.name?` ${a.name}`:""} does not accept any arguments.`);return await new Promise((f,e)=>{const h=(l,k)=>l?(l=c(l),e(l)):f(d||k);let g=[h];Array.isArray(b)?g=[...b,h]:1<Array.from(arguments).length&&(g=[b,h]);a(...g)})};const R=async a=>{try{return await Ja(w,a)}catch(b){return null}};const Ka=path.basename,S=path.dirname,T=path.join,La=path.parse,U=path.relative,Ma=path.resolve;const Na=async a=>{var b=await R(a);let d=a,c=!1;if(!b){if(d=await V(a),!d)throw Error(`${a}.js or ${a}.jsx is not found.`);}else if(b.isDirectory()){b=!1;let f;a.endsWith("/")||(f=d=await V(a),b=!0);if(!f){d=await V(T(a,"index"));if(!d)throw Error(`${b?`${a}.jsx? does not exist, and `:""}index.jsx? file is not found in ${a}`);c=!0}}return{path:a.startsWith(".")?U("",d):d,M:c}},V=async a=>{a=`${a}.js`;let b=await R(a);b||(a=`${a}x`);if(b=await R(a))return a};function W(a,b,d){const c=[];b.replace(a,(f,...e)=>{f=e.slice(0,e.length-2).reduce((h,g,l)=>{l=d[l];if(!l||void 0===g)return h;h[l]=g;return h},{});c.push(f)});return c};/*
 diff package https://github.com/kpdecker/jsdiff
 BSD License
 Copyright (c) 2009-2015, Kevin Decker <kpdecker@gmail.com>
*/
const Oa={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90},Pa={black:40,red:41,green:42,yellow:43,blue:44,magenta:45,cyan:46,white:47};function Qa(a,b){return(b=Oa[b])?`\x1b[${b}m${a}\x1b[0m`:a}function Ra(a,b){return(b=Pa[b])?`\x1b[${b}m${a}\x1b[0m`:a};const Sa=_crypto.createHash;function Ta(a){a=JSON.stringify(a);const b=Buffer.byteLength(a),d=126>b?0:2;var c=0===d?b:126;const f=Buffer.alloc(2+d+b);f.writeUInt8(129,0);f.writeUInt8(c,1);c=2;0<d&&(f.writeUInt16BE(b,2),c+=d);f.write(a,c);return f}function Ua(a){return Sa("sha1").update(`${a}258EAFA5-E914-47DA-95CA-C5AB0DC85B11`,"binary").digest("base64")};function Va(a){const {onMessage:b=()=>{},onConnect:d=()=>{},log:c=!0}={},f={};a.on("upgrade",function(e,h){if("websocket"!=e.headers.upgrade)h.end("HTTP/1.1 400 Bad Request");else{var g=e.headers["sec-websocket-protocol"],l=e.headers["sec-websocket-key"];e=["HTTP/1.1 101 Web Socket Protocol Handshake","Upgrade: WebSocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Ua(l)}`];(g?g.split(",").map(k=>k.trim()):[]).includes("json")&&e.push("Sec-WebSocket-Protocol: json");h.write(e.join("\r\n")+"\r\n\r\n");
c&&console.log(Ra("Client connected.","green"));h.on("data",k=>{var p=k.readUInt8(0)&15;if(8===p)k=null;else if(1===p){var q=k.readUInt8(1),n=!!(q>>>7&1);p=2;q&=127;if(125<q)if(126===q)q=k.readUInt16BE(p),p+=2;else throw k.readUInt32BE(p),k.readUInt32BE(p+4),Error("Large payloads not currently implemented");if(n){var m=k.readUInt32BE(p);p+=4}var r=Buffer.alloc(q);if(n)for(let u=0,t=0;u<q;++u,t=u%4){n=3==t?0:3-t<<3;n=(0==n?m:m>>>n)&255;const D=k.readUInt8(p++);r.writeUInt8(n^D,u)}else k.copy(r,0,p++);
k=`${r}`}else k=void 0;k?b(l,k):null===k&&(delete f[l],c&&console.log(Ra("Client disconnected.","red")))});f[l]=(k,p)=>{h.write(Ta({event:k,message:p}))};d(l)}});return f};let X;
const Xa=async(a,b,d={})=>{X||({root:X}=La(process.cwd()));const {fields:c,soft:f=!1}=d;var e=T(a,"node_modules",b);e=T(e,"package.json");const h=await R(e);if(h){a=await Wa(e,c);if(void 0===a)throw Error(`The package ${U("",e)} does export the module.`);if(!a.entryExists&&!f)throw Error(`The exported module ${a.main} in package ${b} does not exist.`);const {entry:g,version:l,packageName:k,main:p,entryExists:q,...n}=a;return{entry:U("",g),packageJson:U("",e),...l?{version:l}:{},packageName:k,...p?
{hasMain:!0}:{},...q?{}:{entryExists:!1},...n}}if(a==X&&!h)throw Error(`Package.json for module ${b} not found.`);return Xa(T(Ma(a),".."),b,d)},Wa=async(a,b=[])=>{const d=await qa(a);let c,f,e,h,g;try{({module:c,version:f,name:e,main:h,...g}=JSON.parse(d)),g=b.reduce((k,p)=>{k[p]=g[p];return k},{})}catch(k){throw Error(`Could not parse ${a}.`);}a=S(a);b=c||h;if(!b){if(!await R(T(a,"index.js")))return;b=h="index.js"}a=T(a,b);let l;try{({path:l}=await Na(a)),a=l}catch(k){}return{entry:a,version:f,packageName:e,
main:!c&&h,entryExists:!!l,...g}};const Ya=async(a,b,{mount:d,override:c={}})=>{var f=async(e,h,g)=>{var l=S(a);if(/^[/.]/.test(g))return e;{let [q,n,...m]=g.split("/");!q.startsWith("@")&&n?(m=[n,...m],n=q):n=q.startsWith("@")?`${q}/${n}`:q;e={name:n,paths:m.join("/")}}const {name:k,paths:p}=e;if(c[k])return`${h}'${c[k]}'`;({packageJson:l}=await Xa(l,k));e=Ma(l);l=S(e);if(p)return Y(l,p,h,d);({module:e}=require(e));return e?Y(l,e,h,d):(console.warn("[\u219b] Package %s does not specify module in package.json, trying src",l),Y(l,
"src",h))};f=new Aa([{re:/^( *import(?:\s+[^\s,]+\s*,?)?(?:\s*{(?:[^}]+)})?\s+from\s+)['"](.+)['"]/gm,replacement:f},{re:/^( *import\s+)['"](.+)['"]/gm,replacement:f}]);f.end(b);return await F(f)},Y=(a,b,d,c)=>{a=T(a,b);b=U("",a);c&&(b=U(c,b));return`${d}'/${b}${/[/\\]$/.test(a)?"/":""}'`.replace(/\\/g,"/")};function Za(a=""){let b;window.FRONTEND_STYLE_ID?(b=window.FRONTEND_STYLE_ID,b.innerText=""):(b=document.createElement("style"),b.id="FRONTEND_STYLE_ID",document.head.appendChild(b));b.type="text/css";b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a))};const $a=a=>W(/^export\s+(default\s+)?class\s+([^\s{]+)/gm,a,["def","name"]).reduce((b,{def:d,name:c})=>{b[d?"default":c]=c;return b},{}),ab=a=>W(/^export\s+(const|let)\s+(\S+)\s+=/gm,a,["type","name"]).reduce((b,{name:d})=>{b[d]=d;return b},{}),bb=(a,b,d)=>{b=Object.entries(b).map(([c,f])=>`'${c}': ${f},`);return`/* IDIO HOT RELOAD */
if (window.idioHotReload) {
  let i = 0
  idioHotReload('${a}', async () => {
    i++
    const module = await import(\`./${Ka(a).replace(/\.jsx?$/,"")}?ihr=\${i}\`)
${Object.keys(d).map(c=>`    if(\`\${${c}}\` != \`\${module['${c}']}\`) {
      console.log('Export %s updated', '${c}')
      ${c} = module['${c}']
    }`).join("\n")}
    return {
      module,
      classes: {
${b.map(c=>`        ${c}`).join(A)}
      },
    }
  })
}`.replace(/\r?\n/g,A)};let Z;
const cb=ca(T(__dirname,"listener.js")),eb=async(a,b,d,c)=>{const f=c.jsxOptions,e=c.exportClasses;/\.jsx$/.test(a)&&(b=Ia(b,f),d&&(b=`${d}${A}${b}`));return b=/\.css$/.test(a)?db(b,{exportClasses:e,path:a}):await Ya(a,b,c)},db=(a,{exportClasses:b=!0,path:d=""}={})=>{var c=[];b&&(c=a.split(/\r?\n/).filter(f=>/^\S/.test(f)).join(A),c=W(/\.([\w\d_-]+)/g,c,["className"]).map(({className:f})=>f).filter((f,e,h)=>h.indexOf(f)==e));d=d.replace(/\.css$/,"").replace(/[/\\]/g,"-").replace(/[^\w\d_-]/g,"");
return`(${Za.toString().replace(/FRONTEND_STYLE_ID/g,d)})(\`${a}\`)
${c.map(f=>`export const $${f} = '${f}'`).join(A)}`.replace(/\r?\n/g,A).trim()};module.exports=function(a={}){const {directory:b="frontend",pragma:d="import { h } from 'preact'",mount:c=".",override:f={},jsxOptions:e,exportClasses:h=!0,hotReload:g}=a;let {log:l}=a;!0===l&&(l=console.log);let k=Array.isArray(b)?b:[b];k=k.map(m=>{const r=T(c,m);if(!ba(r))throw Error(`Frontend directory ${m} does not exist.`);return m.replace(/\\/g,"/")});let p={},q;g&&({watchers:q={}}=g);let n=!1;return async(m,r)=>{if(g&&m.path==(g.path||"/hot-reload.js"))m.type="js",m.body=cb,n||(m=g.getServer(),
p=Va(m),n=!0);else{var u=m.path.replace("/","");if(!(k.includes(u)||k.some(y=>u.startsWith(`${y}/`))||m.path.startsWith("/node_modules/")))return r();u=T(c,u).replace(/\\/g,"/");var {path:t,M:D}=await Na(u);if(D&&!u.endsWith("/"))r=c?U(c,t).replace(/\\/g,"/"):t,m.redirect(`/${r}`);else{try{var v=await Ja(w,t)}catch(y){m.status=404;return}m.status=200;m.etag=`${v.mtime.getTime()}`;if(m.fresh)return m.status=304,await r();r=await qa(t);v=(new Date).getTime();r=await eb(t,r,d,{mount:c,override:f,jsxOptions:e,
exportClasses:h});var E=(new Date).getTime();l&&l("%s patched in %sms",t,E-v);m.type="application/javascript";if(g&&!m.query.O&&({ignoreNodeModules:v=!0}=g,!t.startsWith("node_modules")||!v)){try{Z||(Z=require("node-watch"))}catch(y){return console.log("Could not require node-watch for front-end hot reload."),console.log("Did you install node-watch?"),m.body=r}t in q||(v=Z(t,(y,pa)=>{console.log("%s File %s changed",Qa("[frontend]","grey"),Qa(pa,"yellow"));Object.values(p).forEach(fb=>{fb("update",
{filename:pa})})}),q[t]=v);v=$a(r);E=ab(r);v=bb(t,v,E);r=r.replace(/export(\s+)const(\s+)(\S+)\s+=/,y=>y.replace("const","let"));r+=`${A}${A}${v}`}m.body=r}}}};

//# sourceMappingURL=front-end.js.map